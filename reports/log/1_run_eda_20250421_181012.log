2025-04-21 18:10:12.738 | INFO     | electricitydemand.utils.log_utils:setup_logger:142 - 文本日志将写入：/home/ubuntu/ElectricityDemand/logs/1_run_eda_20250421_181012.log
2025-04-21 18:10:12.738 | INFO     | electricitydemand.utils.log_utils:setup_logger:180 - 已拦截标准库 logging。
2025-04-21 18:10:12.738 | INFO     | electricitydemand.utils.log_utils:setup_logger:185 - 已设置全局异常处理钩子 (sys.excepthook)。
2025-04-21 18:10:12.739 | INFO     | electricitydemand.utils.log_utils:setup_logger:187 - Loguru 初始化完成。默认级别：INFO. 控制台：INFO. 文件：INFO.
2025-04-21 18:10:12.739 | WARNING  | electricitydemand.utils.log_utils:setup_logger:190 - Diagnose 和 Backtrace 已启用。注意：在生产环境中 'diagnose=True' 可能泄露敏感数据！
2025-04-21 18:10:12.739 | INFO     | __main__:<module>:54 - 项目根目录: /home/ubuntu/ElectricityDemand
2025-04-21 18:10:12.739 | INFO     | __main__:<module>:55 - 数据目录: /home/ubuntu/ElectricityDemand/data
2025-04-21 18:10:12.739 | INFO     | __main__:<module>:56 - 日志目录: /home/ubuntu/ElectricityDemand/logs
2025-04-21 18:10:12.740 | INFO     | __main__:<module>:57 - 图表目录: /home/ubuntu/ElectricityDemand/plots
2025-04-21 18:10:13.190 | INFO     | __main__:run_all_eda:104 - =========================================
2025-04-21 18:10:13.190 | INFO     | __main__:run_all_eda:105 - ===     开始执行 Spark EDA 脚本       ===
2025-04-21 18:10:13.191 | INFO     | __main__:run_all_eda:106 - =========================================
2025-04-21 18:10:13.191 | INFO     | __main__:run_all_eda:113 - 创建 SparkSession...
2025-04-21 18:10:13.191 | INFO     | __main__:run_all_eda:123 - 系统总内存: 57.41GB, 设置驱动器内存: 23g, 执行器内存: 23g
2025-04-21 18:10:16.111 | INFO     | __main__:run_all_eda:135 - SparkSession 创建成功。
2025-04-21 18:10:16.113 | INFO     | __main__:run_all_eda:136 - Spark Web UI: http://10.206.16.11:4041
2025-04-21 18:10:16.113 | INFO     | __main__:run_all_eda:139 - --- 步骤 1: 加载数据 (Spark) ---
2025-04-21 18:10:16.114 | INFO     | electricitydemand.eda.load_data:load_datasets:37 - --- 开始使用 Spark 加载数据集 ---
2025-04-21 18:10:16.114 | INFO     | electricitydemand.eda.load_data:load_datasets:45 - Demand path: /home/ubuntu/ElectricityDemand/data/demand_converted.parquet
2025-04-21 18:10:16.114 | INFO     | electricitydemand.eda.load_data:load_datasets:46 - Metadata path: /home/ubuntu/ElectricityDemand/data/metadata.parquet
2025-04-21 18:10:16.114 | INFO     | electricitydemand.eda.load_data:load_datasets:47 - Weather path: /home/ubuntu/ElectricityDemand/data/weather_converted.parquet
2025-04-21 18:10:16.114 | INFO     | electricitydemand.eda.load_data:load_datasets:50 - 加载 Demand 数据: /home/ubuntu/ElectricityDemand/data/demand_converted.parquet
2025-04-21 18:10:21.662 | WARNING  | electricitydemand.eda.load_data:load_datasets:56 - Demand 'timestamp' 列不是 TimestampType，尝试转换...
2025-04-21 18:10:21.748 | INFO     | electricitydemand.eda.load_data:load_datasets:60 - Demand 'timestamp' 转换后类型: TimestampType()
2025-04-21 18:10:21.748 | INFO     | electricitydemand.eda.load_data:log_sdf_info:24 - Demand DataFrame - Schema:
2025-04-21 18:10:23.607 | INFO     | electricitydemand.eda.load_data:log_sdf_info:27 - Demand DataFrame - Count: 237,944,171
2025-04-21 18:10:23.608 | INFO     | electricitydemand.eda.load_data:load_datasets:69 - 加载 Metadata 数据: /home/ubuntu/ElectricityDemand/data/metadata.parquet
2025-04-21 18:10:23.795 | INFO     | electricitydemand.eda.load_data:log_sdf_info:24 - Metadata DataFrame - Schema:
2025-04-21 18:10:24.286 | INFO     | electricitydemand.eda.load_data:log_sdf_info:27 - Metadata DataFrame - Count: 7,572
2025-04-21 18:10:24.286 | INFO     | electricitydemand.eda.load_data:load_datasets:79 - 加载 Weather 数据: /home/ubuntu/ElectricityDemand/data/weather_converted.parquet
2025-04-21 18:10:24.525 | WARNING  | electricitydemand.eda.load_data:load_datasets:85 - Weather 'timestamp' 列不是 TimestampType，尝试转换...
2025-04-21 18:10:24.608 | INFO     | electricitydemand.eda.load_data:load_datasets:88 - Weather 'timestamp' 转换后类型: TimestampType()
2025-04-21 18:10:24.608 | INFO     | electricitydemand.eda.load_data:log_sdf_info:24 - Weather DataFrame - Schema:
2025-04-21 18:10:24.973 | INFO     | electricitydemand.eda.load_data:log_sdf_info:27 - Weather DataFrame - Count: 604,848
2025-04-21 18:10:24.973 | INFO     | electricitydemand.eda.load_data:load_datasets:95 - --- Spark 数据集加载完成 ---
2025-04-21 18:10:24.974 | INFO     | __main__:run_all_eda:144 - 数据集加载成功。
2025-04-21 18:10:24.974 | INFO     | __main__:run_all_eda:146 - Demand Schema:
2025-04-21 18:10:25.474 | INFO     | __main__:run_all_eda:148 - Demand Count: 237,944,171
2025-04-21 18:10:25.474 | INFO     | __main__:run_all_eda:149 - Metadata Schema:
2025-04-21 18:10:25.697 | INFO     | __main__:run_all_eda:151 - Metadata Count: 7,572
2025-04-21 18:10:25.697 | INFO     | __main__:run_all_eda:152 - Weather Schema:
2025-04-21 18:10:25.989 | INFO     | __main__:run_all_eda:154 - Weather Count: 604,848
2025-04-21 18:10:25.990 | INFO     | __main__:run_all_eda:157 - --- 步骤 2: 单变量分析 ---
2025-04-21 18:10:25.990 | INFO     | __main__:run_all_eda:158 - --- 开始 Demand 分析 (Spark) ---
2025-04-21 18:10:25.990 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_y_distribution:22 - --- 开始使用 Spark 分析 Demand 'y' 列分布 (抽样比例: 0.5%) ---
2025-04-21 18:10:25.990 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_y_distribution:36 - 使用 Spark 计算 'y' 列的描述性统计...
2025-04-21 18:11:00.989 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_y_distribution:55 - 'y' 列 (Spark 全量统计) 描述性统计:
count     2.348579e+08
mean      4.490447e+01
stddev    3.942504e+02
min       0.000000e+00
25%       7.700000e-02
50%       1.990000e-01
75%       7.636528e+00
max       2.212280e+05
2025-04-21 18:11:00.991 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_y_distribution:65 - 使用 Spark 检查 'y' 列中的非正值 (<= 0)...
2025-04-21 18:11:02.544 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_y_distribution:70 - 全量数据中 'y' 缺失的数量: 3,086,278
2025-04-21 18:11:02.545 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_y_distribution:73 - 全量数据中 'y' <= 0 的数量 (在非缺失值中): 2,499,640 (1.08%)
2025-04-21 18:11:02.545 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_y_distribution:78 - 对 'y' 列进行 Spark 抽样 (比例: 0.5%) 以便绘图...
2025-04-21 18:11:02.568 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_y_distribution:85 - 将抽样结果收集到 Pandas Series...
2025-04-21 18:11:03.555 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_y_distribution:93 - 抽样并收集完成，得到 1,176,098 个非空样本 (Pandas)。
2025-04-21 18:11:03.555 | INFO     | electricitydemand.eda.analyze_demand:plot_demand_y_distribution:131 - Original sample size 1,176,098 is large, further sampling 100,000 points for plotting.
2025-04-21 18:11:03.578 | INFO     | electricitydemand.eda.analyze_demand:plot_demand_y_distribution:137 - --- Starting plotting for Demand 'y' distribution (Plot sample size: 100,000) ---
2025-04-21 18:11:03.578 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'y' (Sample size: 100,000)...
2025-04-21 18:12:39.531 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/demand_y_distribution_original_scale.png
2025-04-21 18:12:39.534 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'log1p(y + epsilon)' (Sample size: 100,000)...
2025-04-21 18:12:40.292 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/demand_y_distribution_log1p_scale.png
2025-04-21 18:12:40.293 | INFO     | electricitydemand.eda.analyze_demand:plot_demand_y_distribution:176 - Demand 'y' distribution plotting complete.
2025-04-21 18:12:40.293 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_timeseries_sample:182 - --- Starting Spark analysis of Demand time series (sampling 3 unique_id) ---
2025-04-21 18:12:40.293 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_timeseries_sample:196 - 使用 Spark 获取所有 distinct unique_ids...
2025-04-21 18:12:41.973 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_timeseries_sample:217 - Randomly sampling 3 unique_ids from 7,514 using Spark RDD takeSample...
2025-04-21 18:12:43.822 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_timeseries_sample:228 - Selected unique_ids (first 5): ['9ad9f90f942fde54', '58aac6a4a032e6af', '9a731404275c4fd0']
2025-04-21 18:12:43.822 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_timeseries_sample:231 - 使用 Spark 过滤数据以获取样本 ID 的时间序列...
2025-04-21 18:12:43.871 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_timeseries_sample:241 - 将过滤后的样本数据收集到 Pandas DataFrame (可能需要一些时间和内存)...
2025-04-21 18:12:53.920 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_timeseries_sample:250 - Pandas DataFrame created from Spark sample, containing 93,540 rows for 3 unique_ids.
2025-04-21 18:12:53.920 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_timeseries_sample:276 - Sorting Pandas DataFrame by unique_id and timestamp...
2025-04-21 18:12:53.932 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_timeseries_sample:292 - Starting to plot time series for each sample (in Pandas) and analyze frequency...
2025-04-21 18:12:54.257 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/timeseries_sample_58aac6a4a032e6af.png
2025-04-21 18:12:54.399 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_timeseries_sample:335 - --- unique_id: 58aac6a4a032e6af Timestamp Interval Frequency (Pandas Sample) ---
2025-04-21 18:12:54.399 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_timeseries_sample:340 - Frequency Stats (Top 5):
timestamp
0 days 00:30:00    28541
2025-04-21 18:12:54.649 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/timeseries_sample_9a731404275c4fd0.png
2025-04-21 18:12:54.811 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_timeseries_sample:335 - --- unique_id: 9a731404275c4fd0 Timestamp Interval Frequency (Pandas Sample) ---
2025-04-21 18:12:54.811 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_timeseries_sample:340 - Frequency Stats (Top 5):
timestamp
0 days 00:30:00    34391
2025-04-21 18:12:55.060 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/timeseries_sample_9ad9f90f942fde54.png
2025-04-21 18:12:55.210 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_timeseries_sample:335 - --- unique_id: 9ad9f90f942fde54 Timestamp Interval Frequency (Pandas Sample) ---
2025-04-21 18:12:55.210 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_timeseries_sample:340 - Frequency Stats (Top 5):
timestamp
0 days 00:30:00    30605
2025-04-21 18:12:55.211 | INFO     | electricitydemand.eda.analyze_demand:analyze_demand_timeseries_sample:354 - Time series sample analysis (Spark filter -> Pandas plot/analyze) complete.
2025-04-21 18:12:55.212 | INFO     | __main__:run_all_eda:161 - --- 完成 Demand 分析 (Spark) ---
2025-04-21 18:12:55.212 | INFO     | __main__:run_all_eda:164 - --- 开始 Metadata 分析 (Spark DF -> Pandas DF) ---
2025-04-21 18:12:55.212 | INFO     | __main__:run_all_eda:165 - 将 Metadata Spark DataFrame 转换为 Pandas DataFrame...
2025-04-21 18:12:55.309 | INFO     | __main__:run_all_eda:169 - Metadata Pandas DataFrame 转换成功，形状: (7572, 11)
2025-04-21 18:12:55.310 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_categorical:24 - --- 分析 Metadata 分类特征 ---
2025-04-21 18:12:55.310 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_categorical:31 - --- 分析列: dataset ---
2025-04-21 18:12:55.311 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_categorical:35 - 值分布 (Top 10):
dataset
London Smart Meter Data      5566
Building Data Genome 2       1636
Electricity Load Diagrams     370
2025-04-21 18:12:55.311 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_categorical:31 - --- 分析列: location ---
2025-04-21 18:12:55.312 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_categorical:35 - 值分布 (Top 10):
location
London, UK                     5634
PT                              370
Washington DC, USA              305
None                            237
Minneapolis, Minnesota, USA     163
Cardiff, UK                     147
Phoenix, Arizona, USA           137
Orlando, Florida, USA           136
Ithaca, New York, USA           124
Austin, Texas, USA              124
2025-04-21 18:12:55.312 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_categorical:37 - ... (共 14 个唯一值)
2025-04-21 18:12:55.312 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_categorical:31 - --- 分析列: timezone ---
2025-04-21 18:12:55.313 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_categorical:35 - 值分布 (Top 10):
timezone
Europe/London    5781
US/Eastern        812
Europe/Lisbon     370
US/Central        287
US/Mountain       173
US/Pacific        113
Europe/Dublin      36
2025-04-21 18:12:55.313 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_categorical:31 - --- 分析列: freq ---
2025-04-21 18:12:55.314 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_categorical:35 - 值分布 (Top 10):
freq
30T    5566
1H     1636
15T     370
2025-04-21 18:12:55.314 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_categorical:31 - --- 分析列: building_class ---
2025-04-21 18:12:55.314 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_categorical:35 - 值分布 (Top 10):
building_class
Residential    5936
Commercial     1636
2025-04-21 18:12:55.314 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_categorical:40 - --- 完成 Metadata 分类特征分析 ---
2025-04-21 18:12:55.315 | INFO     | electricitydemand.eda.analyze_metadata:plot_metadata_categorical:51 - --- 绘制 Metadata 分类特征分布图 ---
2025-04-21 18:12:55.315 | INFO     | electricitydemand.eda.analyze_metadata:plot_metadata_categorical:63 - 绘制 'dataset' 的分布图 (共 3 个唯一值)...
2025-04-21 18:12:55.461 | INFO     | electricitydemand.eda.analyze_metadata:plot_metadata_categorical:95 - 图表已保存: /home/ubuntu/ElectricityDemand/plots/metadata_dist_dataset.png
2025-04-21 18:12:55.461 | INFO     | electricitydemand.eda.analyze_metadata:plot_metadata_categorical:63 - 绘制 'location' 的分布图 (共 14 个唯一值)...
2025-04-21 18:12:55.718 | INFO     | electricitydemand.eda.analyze_metadata:plot_metadata_categorical:95 - 图表已保存: /home/ubuntu/ElectricityDemand/plots/metadata_dist_location.png
2025-04-21 18:12:55.718 | INFO     | electricitydemand.eda.analyze_metadata:plot_metadata_categorical:63 - 绘制 'timezone' 的分布图 (共 7 个唯一值)...
2025-04-21 18:12:55.886 | INFO     | electricitydemand.eda.analyze_metadata:plot_metadata_categorical:95 - 图表已保存: /home/ubuntu/ElectricityDemand/plots/metadata_dist_timezone.png
2025-04-21 18:12:55.887 | INFO     | electricitydemand.eda.analyze_metadata:plot_metadata_categorical:63 - 绘制 'freq' 的分布图 (共 3 个唯一值)...
2025-04-21 18:12:55.896 | INFO     | logging:callHandlers:1762 - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-04-21 18:12:55.901 | INFO     | logging:callHandlers:1762 - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-04-21 18:12:56.017 | INFO     | electricitydemand.eda.analyze_metadata:plot_metadata_categorical:95 - 图表已保存: /home/ubuntu/ElectricityDemand/plots/metadata_dist_freq.png
2025-04-21 18:12:56.018 | INFO     | electricitydemand.eda.analyze_metadata:plot_metadata_categorical:63 - 绘制 'building_class' 的分布图 (共 2 个唯一值)...
2025-04-21 18:12:56.151 | INFO     | electricitydemand.eda.analyze_metadata:plot_metadata_categorical:95 - 图表已保存: /home/ubuntu/ElectricityDemand/plots/metadata_dist_building_class.png
2025-04-21 18:12:56.151 | INFO     | electricitydemand.eda.analyze_metadata:plot_metadata_categorical:100 - --- 完成 Metadata 分类特征分布图绘制 ---
2025-04-21 18:12:56.152 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_numerical:111 - --- 分析 Metadata 数值特征 ---
2025-04-21 18:12:56.158 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_numerical:124 - 数值特征描述性统计:
          latitude    longitude  cluster_size
count  7335.000000  7335.000000        7572.0
mean     48.755646   -14.083789           1.0
std       5.873737    33.140486           0.0
min      28.520000  -122.260000           1.0
25%      51.520000    -0.130000           1.0
50%      51.520000    -0.130000           1.0
75%      51.520000    -0.130000           1.0
max      53.350000     6.260000           1.0
2025-04-21 18:12:56.339 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_numerical:142 - 'latitude' 直方图已保存: /home/ubuntu/ElectricityDemand/plots/metadata_hist_latitude.png
2025-04-21 18:12:56.543 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_numerical:142 - 'longitude' 直方图已保存: /home/ubuntu/ElectricityDemand/plots/metadata_hist_longitude.png
2025-04-21 18:12:56.724 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_numerical:142 - 'cluster_size' 直方图已保存: /home/ubuntu/ElectricityDemand/plots/metadata_hist_cluster_size.png
2025-04-21 18:12:56.898 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_numerical:163 - 地理位置散点图已保存: /home/ubuntu/ElectricityDemand/plots/metadata_location_scatter.png
2025-04-21 18:12:56.898 | INFO     | electricitydemand.eda.analyze_metadata:analyze_metadata_numerical:171 - --- 完成 Metadata 数值特征分析 ---
2025-04-21 18:12:56.898 | INFO     | electricitydemand.eda.analyze_metadata:analyze_missing_locations:183 - --- 开始分析 Metadata 中缺失的位置信息 ---
2025-04-21 18:12:56.900 | INFO     | electricitydemand.eda.analyze_metadata:analyze_missing_locations:201 - 发现 237 行的所有位置信息 (location_id, latitude, longitude, location) 均为缺失。
2025-04-21 18:12:56.903 | INFO     | electricitydemand.eda.analyze_metadata:analyze_missing_locations:208 - 缺失位置信息的行 (前 5 行):
                                 dataset             building_id location_id  latitude  longitude location    timezone building_class  cluster_size freq
unique_id                                                                                                                                               
af7d0992308ddcbf  Building Data Genome 2     Gator_office_Carrie        None       NaN        NaN     None  US/Eastern     Commercial             1   1H
647d0556e538682a  Building Data Genome 2       Gator_office_Lucy        None       NaN        NaN     None  US/Eastern     Commercial             1   1H
84be3f18f01d3ddb  Building Data Genome 2    Gator_assembly_Lelia        None       NaN        NaN     None  US/Eastern     Commercial             1   1H
0bafabde1547223b  Building Data Genome 2    Gator_other_Elfriede        None       NaN        NaN     None  US/Eastern     Commercial             1   1H
e2cae95c19389c9d  Building Data Genome 2  Gator_assembly_Maurine        None       NaN        NaN     None  US/Eastern     Commercial             1   1H
2025-04-21 18:12:56.903 | INFO     | electricitydemand.eda.analyze_metadata:analyze_missing_locations:209 - 分析缺失位置信息行的其他特征分布:
2025-04-21 18:12:56.903 | INFO     | electricitydemand.utils.eda_utils:log_value_counts:150 - --- 分析列：(缺失位置) dataset 值分布 ---
2025-04-21 18:12:56.905 | INFO     | electricitydemand.utils.eda_utils:log_value_counts:245 - 值分布 (含 NaN):
                         计数  百分比 (%)
dataset                             
Building Data Genome 2  237    100.0
2025-04-21 18:12:56.905 | INFO     | electricitydemand.utils.eda_utils:log_value_counts:278 - 列 '(缺失位置) dataset' 值计数中未发现 NaN。
2025-04-21 18:12:56.905 | INFO     | electricitydemand.utils.eda_utils:log_value_counts:283 - 列 '(缺失位置) dataset' 唯一值数量 (含 NaN): 1
2025-04-21 18:12:56.905 | INFO     | electricitydemand.utils.eda_utils:log_value_counts:285 - --------------------
2025-04-21 18:12:56.906 | INFO     | electricitydemand.utils.eda_utils:log_value_counts:150 - --- 分析列：(缺失位置) building_class 值分布 ---
2025-04-21 18:12:56.907 | INFO     | electricitydemand.utils.eda_utils:log_value_counts:245 - 值分布 (含 NaN):
                 计数  百分比 (%)
building_class              
Commercial      237    100.0
2025-04-21 18:12:56.908 | INFO     | electricitydemand.utils.eda_utils:log_value_counts:278 - 列 '(缺失位置) building_class' 值计数中未发现 NaN。
2025-04-21 18:12:56.908 | INFO     | electricitydemand.utils.eda_utils:log_value_counts:283 - 列 '(缺失位置) building_class' 唯一值数量 (含 NaN): 1
2025-04-21 18:12:56.908 | INFO     | electricitydemand.utils.eda_utils:log_value_counts:285 - --------------------
2025-04-21 18:12:56.908 | INFO     | electricitydemand.utils.eda_utils:log_value_counts:150 - --- 分析列：(缺失位置) freq 值分布 ---
2025-04-21 18:12:56.910 | INFO     | electricitydemand.utils.eda_utils:log_value_counts:245 - 值分布 (含 NaN):
       计数  百分比 (%)
freq              
1H    237    100.0
2025-04-21 18:12:56.910 | INFO     | electricitydemand.utils.eda_utils:log_value_counts:278 - 列 '(缺失位置) freq' 值计数中未发现 NaN。
2025-04-21 18:12:56.910 | INFO     | electricitydemand.utils.eda_utils:log_value_counts:283 - 列 '(缺失位置) freq' 唯一值数量 (含 NaN): 1
2025-04-21 18:12:56.910 | INFO     | electricitydemand.utils.eda_utils:log_value_counts:285 - --------------------
2025-04-21 18:12:56.910 | INFO     | electricitydemand.eda.analyze_metadata:analyze_missing_locations:226 - 缺失位置信息分析完成。
2025-04-21 18:12:56.911 | INFO     | __main__:run_all_eda:189 - --- 完成 Metadata 分析 ---
2025-04-21 18:12:56.911 | INFO     | __main__:run_all_eda:196 - --- 开始 Weather 分析 (Spark) ---
2025-04-21 18:12:56.911 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:57 - --- 开始分析 Weather 数值特征分布 (Spark) ---
2025-04-21 18:12:56.911 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:85 - 使用 Spark 计算数值特征的描述性统计...
2025-04-21 18:13:15.398 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:123 - Spark 计算的描述性统计:
        temperature_2m  relative_humidity_2m   dew_point_2m  apparent_temperature  precipitation           rain       snowfall     snow_depth   pressure_msl  surface_pressure    cloud_cover  cloud_cover_low  cloud_cover_mid  cloud_cover_high  et0_fao_evapotranspiration  vapour_pressure_deficit  wind_speed_10m  wind_direction_10m  wind_gusts_10m  soil_temperature_0_to_7cm  soil_temperature_7_to_28cm  soil_moisture_0_to_7cm  soil_moisture_7_to_28cm  sunshine_duration  shortwave_radiation  direct_radiation  diffuse_radiation  direct_normal_irradiance  terrestrial_radiation
count    604848.000000         604848.000000  604848.000000         604848.000000  604848.000000  604848.000000  604848.000000  604848.000000  604848.000000     604848.000000  604848.000000    604848.000000    604848.000000     604848.000000               604848.000000            604848.000000   604848.000000       604848.000000   604848.000000              604848.000000               604848.000000           604848.000000            604848.000000      604848.000000        604848.000000     604848.000000      604848.000000             604848.000000          604848.000000
mean         13.043232             72.994254       7.469432             11.199999       0.104439       0.098115       0.004602       0.016962    1016.344055       1005.593240      47.802610        31.496008        26.783263         35.679511                    0.110859                 0.575833       12.791896          197.332483       26.637381                  14.073293                   14.007569                0.312330                 0.320900        1230.290619           160.496367        103.807467          56.688900                186.054919             314.664655
stddev        9.862261             19.791132       9.148833             11.900755       0.483059       0.476445       0.055332       0.068546       8.433961         14.500265      37.891868        38.231071        35.325166         41.178399                    0.156858                 0.831642        6.774915           96.776903       13.148384                   9.628982                    8.727776                0.123079                 0.108136        1646.818797           241.076100        188.234869          77.751038                279.753732             398.050797
min         -32.200001              2.582063     -36.099998            -37.681385       0.000000       0.000000       0.000000       0.000000     970.599976        952.082153       0.000000         0.000000         0.000000          0.000000                    0.000000                 0.000000        0.000000            0.440730        1.440000                 -20.711000                  -15.361000                0.000000                 0.027000           0.000000             0.000000          0.000000           0.000000                  0.000000               0.000000
25%           6.997500             61.176437       2.283000              3.391027       0.000000       0.000000       0.000000       0.000000    1011.700012        997.936157      10.200001         0.000000         0.000000          0.000000                    0.006063                 0.125121        7.787991          120.256355       16.559999                   7.226500                    7.603000                0.238000                 0.244000           0.000000             0.000000          0.000000           0.000000                  0.000000               0.000000
50%          13.326500             77.333199       8.600000             11.259665       0.000000       0.000000       0.000000       0.000000    1016.500000       1008.601440      41.099998        10.000000         6.000000          9.000000                    0.038774                 0.285856       11.585320          211.660706       24.480000                  13.926500                   14.176500                0.341000                 0.340000           0.000000             7.000000          0.000000           6.000000                  0.000000              51.724712
75%          19.592499             88.814079      13.576500             19.278246       0.000000       0.000000       0.000000       0.000000    1021.400024       1015.447266      89.999992        64.000000        47.000000         84.000000                    0.151983                 0.671277       16.595179          273.012726       34.379997                  20.217499                   19.839500                0.400000                 0.400000        3600.000000           262.000000        122.000000         100.000000                333.468933             620.696228
max          47.613499            100.000000      27.320002             48.003006      33.000000      33.000000       4.270000       0.790000    1051.000000       1044.969727     100.000000       100.000000       100.000000        100.000000                    1.109937                10.356438       66.794312          360.000000      128.159988                  61.289501                   43.089500                0.520000                 0.520000        3600.000000          1079.000000        952.000000         488.000000               1017.039001            1318.578247
2025-04-21 18:13:15.399 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:136 - 使用 Spark 检查列 ['precipitation', 'rain', 'snowfall', 'snow_depth', 'et0_fao_evapotranspiration', 'sunshine_duration', 'direct_radiation', 'diffuse_radiation'] 中的负值...
2025-04-21 18:13:15.485 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:145 - 列 'precipitation' 未检测到负值。
2025-04-21 18:13:15.543 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:145 - 列 'rain' 未检测到负值。
2025-04-21 18:13:15.599 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:145 - 列 'snowfall' 未检测到负值。
2025-04-21 18:13:15.657 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:145 - 列 'snow_depth' 未检测到负值。
2025-04-21 18:13:15.736 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:145 - 列 'et0_fao_evapotranspiration' 未检测到负值。
2025-04-21 18:13:15.808 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:145 - 列 'sunshine_duration' 未检测到负值。
2025-04-21 18:13:15.863 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:145 - 列 'direct_radiation' 未检测到负值。
2025-04-21 18:13:15.918 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:145 - 列 'diffuse_radiation' 未检测到负值。
2025-04-21 18:13:15.919 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:151 - 开始绘制 Weather 特征分布图 (抽样比例: 5.0%)...
2025-04-21 18:13:15.919 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: temperature_2m
2025-04-21 18:13:15.996 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'temperature_2m' (Sample size: 30,210)...
2025-04-21 18:13:16.399 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_temperature_2m.png
2025-04-21 18:13:16.400 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: relative_humidity_2m
2025-04-21 18:13:16.464 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'relative_humidity_2m' (Sample size: 30,210)...
2025-04-21 18:13:16.833 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_relative_humidity_2m.png
2025-04-21 18:13:16.833 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: dew_point_2m
2025-04-21 18:13:16.885 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'dew_point_2m' (Sample size: 30,210)...
2025-04-21 18:13:17.278 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_dew_point_2m.png
2025-04-21 18:13:17.278 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: apparent_temperature
2025-04-21 18:13:17.331 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'apparent_temperature' (Sample size: 30,210)...
2025-04-21 18:13:17.728 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_apparent_temperature.png
2025-04-21 18:13:17.728 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: precipitation
2025-04-21 18:13:17.780 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'precipitation' (Sample size: 30,210)...
2025-04-21 18:13:18.141 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_precipitation.png
2025-04-21 18:13:18.141 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: rain
2025-04-21 18:13:18.192 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'rain' (Sample size: 30,210)...
2025-04-21 18:13:18.575 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_rain.png
2025-04-21 18:13:18.575 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: snowfall
2025-04-21 18:13:18.629 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'snowfall' (Sample size: 30,210)...
2025-04-21 18:13:19.001 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_snowfall.png
2025-04-21 18:13:19.001 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: snow_depth
2025-04-21 18:13:19.052 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'snow_depth' (Sample size: 30,210)...
2025-04-21 18:13:19.420 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_snow_depth.png
2025-04-21 18:13:19.420 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: pressure_msl
2025-04-21 18:13:19.471 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'pressure_msl' (Sample size: 30,210)...
2025-04-21 18:13:19.910 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_pressure_msl.png
2025-04-21 18:13:19.910 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: surface_pressure
2025-04-21 18:13:19.964 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'surface_pressure' (Sample size: 30,210)...
2025-04-21 18:13:20.351 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_surface_pressure.png
2025-04-21 18:13:20.352 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: cloud_cover
2025-04-21 18:13:20.413 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'cloud_cover' (Sample size: 30,210)...
2025-04-21 18:13:20.747 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_cloud_cover.png
2025-04-21 18:13:20.747 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: cloud_cover_low
2025-04-21 18:13:20.798 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'cloud_cover_low' (Sample size: 30,210)...
2025-04-21 18:13:21.139 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_cloud_cover_low.png
2025-04-21 18:13:21.139 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: cloud_cover_mid
2025-04-21 18:13:21.193 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'cloud_cover_mid' (Sample size: 30,210)...
2025-04-21 18:13:21.539 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_cloud_cover_mid.png
2025-04-21 18:13:21.539 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: cloud_cover_high
2025-04-21 18:13:21.592 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'cloud_cover_high' (Sample size: 30,210)...
2025-04-21 18:13:21.918 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_cloud_cover_high.png
2025-04-21 18:13:21.918 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: et0_fao_evapotranspiration
2025-04-21 18:13:21.971 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'et0_fao_evapotranspiration' (Sample size: 30,210)...
2025-04-21 18:13:22.418 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_et0_fao_evapotranspiration.png
2025-04-21 18:13:22.419 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: vapour_pressure_deficit
2025-04-21 18:13:22.470 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'vapour_pressure_deficit' (Sample size: 30,210)...
2025-04-21 18:13:23.004 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_vapour_pressure_deficit.png
2025-04-21 18:13:23.004 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: wind_speed_10m
2025-04-21 18:13:23.059 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'wind_speed_10m' (Sample size: 30,210)...
2025-04-21 18:13:23.489 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_wind_speed_10m.png
2025-04-21 18:13:23.489 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: wind_direction_10m
2025-04-21 18:13:23.541 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'wind_direction_10m' (Sample size: 30,210)...
2025-04-21 18:13:23.902 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_wind_direction_10m.png
2025-04-21 18:13:23.903 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: wind_gusts_10m
2025-04-21 18:13:23.956 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'wind_gusts_10m' (Sample size: 30,210)...
2025-04-21 18:13:24.390 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_wind_gusts_10m.png
2025-04-21 18:13:24.390 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: soil_temperature_0_to_7cm
2025-04-21 18:13:24.442 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'soil_temperature_0_to_7cm' (Sample size: 30,210)...
2025-04-21 18:13:24.848 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_soil_temperature_0_to_7cm.png
2025-04-21 18:13:24.848 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: soil_temperature_7_to_28cm
2025-04-21 18:13:24.899 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'soil_temperature_7_to_28cm' (Sample size: 30,210)...
2025-04-21 18:13:25.268 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_soil_temperature_7_to_28cm.png
2025-04-21 18:13:25.268 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: soil_moisture_0_to_7cm
2025-04-21 18:13:25.318 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'soil_moisture_0_to_7cm' (Sample size: 30,210)...
2025-04-21 18:13:25.675 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_soil_moisture_0_to_7cm.png
2025-04-21 18:13:25.675 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: soil_moisture_7_to_28cm
2025-04-21 18:13:25.725 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'soil_moisture_7_to_28cm' (Sample size: 30,210)...
2025-04-21 18:13:26.072 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_soil_moisture_7_to_28cm.png
2025-04-21 18:13:26.072 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: sunshine_duration
2025-04-21 18:13:26.125 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'sunshine_duration' (Sample size: 30,210)...
2025-04-21 18:13:26.475 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_sunshine_duration.png
2025-04-21 18:13:26.475 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: shortwave_radiation
2025-04-21 18:13:26.526 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'shortwave_radiation' (Sample size: 30,210)...
2025-04-21 18:13:26.889 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_shortwave_radiation.png
2025-04-21 18:13:26.890 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: direct_radiation
2025-04-21 18:13:26.939 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'direct_radiation' (Sample size: 30,210)...
2025-04-21 18:13:27.345 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_direct_radiation.png
2025-04-21 18:13:27.345 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: diffuse_radiation
2025-04-21 18:13:27.395 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'diffuse_radiation' (Sample size: 30,210)...
2025-04-21 18:13:27.784 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_diffuse_radiation.png
2025-04-21 18:13:27.784 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: direct_normal_irradiance
2025-04-21 18:13:27.837 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'direct_normal_irradiance' (Sample size: 30,210)...
2025-04-21 18:13:28.182 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_direct_normal_irradiance.png
2025-04-21 18:13:28.182 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:153 - 绘制列: terrestrial_radiation
2025-04-21 18:13:28.234 | INFO     | electricitydemand.utils.eda_utils:plot_numerical_distribution:33 - Plotting distribution for column 'terrestrial_radiation' (Sample size: 30,210)...
2025-04-21 18:13:28.593 | INFO     | electricitydemand.utils.eda_utils:save_plot:20 - 图表已保存到：/home/ubuntu/ElectricityDemand/plots/weather_distribution_terrestrial_radiation.png
2025-04-21 18:13:28.593 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_numerical:179 - Weather 数值特征分析完成。
2025-04-21 18:13:28.593 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_categorical:190 - --- 分析 Weather 分类特征 (Spark) ---
2025-04-21 18:13:28.593 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_categorical:196 - --- 分析列: is_day ---
2025-04-21 18:13:28.883 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_categorical:202 - 'is_day' 值分布 (Top 20):
 is_day  count
    1.0 307957
    0.0 296672
    0.5    219
2025-04-21 18:13:28.894 | INFO     | logging:callHandlers:1762 - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-04-21 18:13:28.898 | INFO     | logging:callHandlers:1762 - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-04-21 18:13:29.014 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_categorical:235 - 'is_day' 分布图已保存: /home/ubuntu/ElectricityDemand/plots/weather_dist_is_day.png
2025-04-21 18:13:29.014 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_categorical:196 - --- 分析列: weather_code ---
2025-04-21 18:13:29.175 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_categorical:202 - 'weather_code' 值分布 (Top 20):
 weather_code  count
          0.0 189824
          1.0 123921
          3.0 117225
          2.0  66923
         51.0  44892
         53.0  14586
         61.0   7727
         71.0   6788
          0.5   5861
         55.0   4226
         63.0   3884
         73.0   3729
          1.5   3656
          2.5   1701
         27.0   1515
         26.0   1491
         26.5   1384
         75.0    638
         52.0    621
         25.5    590
2025-04-21 18:13:29.175 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_categorical:204 - ... (共 41 个唯一值)
2025-04-21 18:13:29.466 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_categorical:235 - 'weather_code' 分布图已保存: /home/ubuntu/ElectricityDemand/plots/weather_dist_weather_code.png
2025-04-21 18:13:29.466 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_categorical:241 - --- 完成 Weather 分类特征分析 ---
2025-04-21 18:13:29.466 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_timeseries_sample:329 - --- Starting Spark analysis of Weather time series frequency (sampling 3 location_id) ---
2025-04-21 18:13:29.467 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_timeseries_sample:343 - 使用 Spark 获取所有 distinct location_ids...
2025-04-21 18:13:29.729 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_timeseries_sample:361 - Randomly sampling 3 location_ids from 16 using Spark RDD takeSample...
2025-04-21 18:13:29.939 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_timeseries_sample:369 - Selected location_ids (first 5): ['f244mkkywjsv', '9v6kpy7zsbvx', '9zvxvu65krxz']
2025-04-21 18:13:29.939 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_timeseries_sample:372 - 使用 Spark 过滤 Weather 数据以获取样本 ID 的时间序列...
2025-04-21 18:13:29.963 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_timeseries_sample:379 - 将过滤后的 Weather 样本数据收集到 Pandas DataFrame...
2025-04-21 18:13:30.355 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_timeseries_sample:385 - Weather Pandas DataFrame created from Spark sample, containing 105,192 rows for 3 location_ids.
2025-04-21 18:13:30.356 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_timeseries_sample:393 - Sorting Weather Pandas DataFrame by location_id and timestamp...
2025-04-21 18:13:30.368 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_timeseries_sample:407 - Starting to analyze weather timestamp frequency for each sample (in Pandas)...
2025-04-21 18:13:30.547 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_timeseries_sample:422 - --- location_id: 9v6kpy7zsbvx Weather Timestamp Interval Frequency (Pandas Sample) ---
2025-04-21 18:13:30.547 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_timeseries_sample:427 - Frequency Stats (Top 5):
timestamp
0 days 01:00:00    35063
2025-04-21 18:13:30.719 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_timeseries_sample:422 - --- location_id: 9zvxvu65krxz Weather Timestamp Interval Frequency (Pandas Sample) ---
2025-04-21 18:13:30.720 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_timeseries_sample:427 - Frequency Stats (Top 5):
timestamp
0 days 01:00:00    35063
2025-04-21 18:13:30.885 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_timeseries_sample:422 - --- location_id: f244mkkywjsv Weather Timestamp Interval Frequency (Pandas Sample) ---
2025-04-21 18:13:30.885 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_timeseries_sample:427 - Frequency Stats (Top 5):
timestamp
0 days 01:00:00    35063
2025-04-21 18:13:30.886 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_timeseries_sample:441 - Weather time series frequency sample analysis (Spark filter -> Pandas analyze) complete.
2025-04-21 18:13:30.886 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_correlation:252 - --- 分析 Weather 数值特征相关性 (Spark) ---
2025-04-21 18:13:30.886 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_correlation:276 - 计算以下列的相关性: temperature_2m, relative_humidity_2m, dew_point_2m, apparent_temperature, precipitation, rain, snowfall, snow_depth, pressure_msl, surface_pressure, cloud_cover, cloud_cover_low, cloud_cover_mid, cloud_cover_high, et0_fao_evapotranspiration, vapour_pressure_deficit, wind_speed_10m, wind_direction_10m, wind_gusts_10m, soil_temperature_0_to_7cm, soil_moisture_0_to_7cm, sunshine_duration, shortwave_radiation, direct_radiation, diffuse_radiation, direct_normal_irradiance, terrestrial_radiation
2025-04-21 18:13:37.879 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_correlation:303 - 天气特征相关性热力图已保存: /home/ubuntu/ElectricityDemand/plots/weather_correlation_matrix.png
2025-04-21 18:13:37.890 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_correlation:312 - --- 强相关性 (|corr| > 0.8) ---
2025-04-21 18:13:37.891 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_correlation:313 - apparent_temperature        temperature_2m                0.988910
precipitation               rain                          0.986577
direct_radiation            shortwave_radiation           0.964157
soil_temperature_0_to_7cm   temperature_2m                0.956536
                            apparent_temperature          0.948871
shortwave_radiation         et0_fao_evapotranspiration    0.944134
direct_radiation            direct_normal_irradiance      0.922058
et0_fao_evapotranspiration  direct_radiation              0.920355
wind_speed_10m              wind_gusts_10m                0.910252
shortwave_radiation         terrestrial_radiation         0.909390
terrestrial_radiation       diffuse_radiation             0.902464
direct_normal_irradiance    shortwave_radiation           0.893868
sunshine_duration           direct_normal_irradiance      0.891042
apparent_temperature        dew_point_2m                  0.858306
terrestrial_radiation       et0_fao_evapotranspiration    0.857942
cloud_cover                 cloud_cover_low               0.817122
shortwave_radiation         sunshine_duration             0.815321
direct_normal_irradiance    et0_fao_evapotranspiration    0.813937
temperature_2m              dew_point_2m                  0.813515
2025-04-21 18:13:37.891 | INFO     | electricitydemand.eda.analyze_weather:analyze_weather_correlation:320 - --- 完成 Weather 数值特征相关性分析 ---
2025-04-21 18:13:37.891 | INFO     | __main__:run_all_eda:202 - --- 完成 Weather 分析 (Spark) ---
2025-04-21 18:13:37.891 | INFO     | __main__:run_all_eda:205 - --- 步骤 3: 关系分析 ---
2025-04-21 18:13:37.892 | INFO     | __main__:run_all_eda:208 - --- 开始 Demand vs building_class 分析 (Spark->Pandas) ---
2025-04-21 18:13:37.892 | CRITICAL | __main__:run_all_eda:252 - 执行过程中发生严重错误: analyze_demand_vs_metadata() got an unexpected keyword argument 'spark'
2025-04-21 18:13:37.892 | ERROR    | __main__:run_all_eda:253 - Traceback:
Traceback (most recent call last):

  File "/home/ubuntu/ElectricityDemand/src/electricitydemand/1_run_eda.py", line 274, in <module>
    run_all_eda() # 取消注释以运行
    └ <function run_all_eda at 0x769f025e6a20>

> File "/home/ubuntu/ElectricityDemand/src/electricitydemand/1_run_eda.py", line 209, in run_all_eda
    analyze_demand_vs_metadata(sdf_demand, pdf_metadata, target_col='building_class', plots_dir=plots_dir, sample_frac=0.001, spark=spark)
    │                          │           │                                                    │                                   └ <pyspark.sql.session.SparkSession object at 0x769ef4589160>
    │                          │           │                                                    └ PosixPath('/home/ubuntu/ElectricityDemand/plots')
    │                          │           └                                     dataset building_id   location_id  ...  building_class  cluster_size freq
    │                          │             unique_id      ...
    │                          └ DataFrame[unique_id: string, timestamp: timestamp, y: double]
    └ <function analyze_demand_vs_metadata at 0x769ef7bda8e0>

TypeError: analyze_demand_vs_metadata() got an unexpected keyword argument 'spark'
2025-04-21 18:13:37.912 | INFO     | __main__:run_all_eda:258 - 正在停止 SparkSession...
2025-04-21 18:13:38.205 | INFO     | __main__:run_all_eda:260 - SparkSession 已停止。
2025-04-21 18:13:38.205 | INFO     | __main__:run_all_eda:269 - --- EDA 脚本总执行时间: 205.01 秒 ---
